<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>회원가입</title>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script src="https://code.jquery.com/jquery-3.7.1.js" crossorigin="anonymous"></script>
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f0f2f5;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        margin: 0;
    }
    .container {
        background-color: #fff;
        padding: 40px;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        width: 100%;
        max-width: 500px;
        box-sizing: border-box;
    }
    h2 {
        color: #333;
        text-align: center;
        margin-bottom: 25px;
    }
    .form-section {
        margin-bottom: 25px;
        padding: 15px;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
    }
    .form-section.optional {
        border-style: dashed;
        background-color: #fafafa;
    }
    .form-section h3 {
        margin-top: 0;
        color: #555;
        font-size: 1.1em;
    }
    .form-group {
        margin-bottom: 15px;
    }
    .form-group label {
        display: block;
        margin-bottom: 5px;
        color: #555;
        font-weight: bold;
    }
    .form-group input, .form-group select {
        width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        box-sizing: border-box;
    }
    .gender-inline {
        display: flex;
        gap: 20px;
        align-items: center;
    }
    .gender-inline label {
        display: flex;
        align-items: center;
        gap: 5px;
        margin: 0;
        font-weight: normal;
    }
    .gender-inline input[type="radio"] {
        margin: 0;
        width: auto;
    }
    .role-inline {
        display: flex;
        gap: 10px;         
        align-items: center;
        flex-wrap: nowrap;   
    }
    .role-inline label {
        white-space: nowrap; 
        font-weight: normal;
    }
    .role-inline input[type="radio"] {
        margin: 0;
        width: auto;
    }
    .button-inline {
        display: flex;
        gap: 10px;
        align-items: center;
    }
    .register-button, .check-button {
        padding: 12px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-weight: bold;
    }
    .register-button {
        background-color: #28a745;
        color: #fff;
        width: 100%;
        margin-top: 20px;
    }
    .check-button {
        background-color: #007bff;
        color: #fff;
    }
    .cancel-button {
    background-color: #fff;
    color: #555;             
    border: 1px solid #ccc;  
    padding: 12px;
    border-radius: 5px;
    cursor: pointer;
    width: 100%;
    margin-top: 10px;
    }

    .cancel-button:hover {
    background-color: #f2f2f2; 
    }
</style>
</head>
<body>
<div id="app" class="container">
    <h2>{{ isAdminMode ? '회원 추가' : '회원 가입' }}</h2>
    <form @submit.prevent="fnSignUp">
        <div class="form-section">
            <h3>필수 정보</h3>
            <div class="form-group button-inline">
                <input type="text" placeholder="아이디를 입력하세요" v-model="userName" required>
                <button type="button" class="check-button" @click="checkUserName">중복 체크</button>
            </div>
            <div class="form-group">
                <input type="password" placeholder="비밀번호" v-model="password" required>
            </div>
            <div class="form-group">
                <input type="password" placeholder="비밀번호 확인" v-model="confirmPassword" required>
            </div>
            <div class="form-group">
                <input type="text" placeholder="이름" v-model="name" required>
            </div>
            <div class="form-group">
                <input type="text" placeholder="닉네임" v-model="nickName" required>
            </div>
            <div class="form-group">
                <div style="display: flex; gap: 10px;">
                    <select v-model="phonePrefix" style="width: 120px;">
                        <option value="010">010</option>
                        <option value="011">011</option>
                        <option value="017">017</option>
                        <option value="019">019</option>
                    </select>
                    <input type="text" v-model="phoneMiddle" placeholder="1234" maxlength="4" style="flex: 1;" required>
                    <input type="text" v-model="phoneLast" placeholder="5678" maxlength="4" style="flex: 1;" required>
                </div>
            </div>
            <div class="form-group">
                <input type="email" placeholder="이메일" v-model="email" required>
            </div>
            <div class="form-group">
                <select v-model="currentAddress" required>
                    <option value="">주소 선택</option>
                    <option value="서울특별시">서울특별시</option>
                    <option value="부산광역시">부산광역시</option>
                    <option value="대구광역시">대구광역시</option>
                    <option value="인천광역시">인천광역시</option>
                    <option value="광주광역시">광주광역시</option>
                    <option value="대전광역시">대전광역시</option>
                    <option value="울산광역시">울산광역시</option>
                    <option value="세종특별자치시">세종특별자치시</option>
                    <option value="경기도">경기도</option>
                    <option value="강원도">강원도</option>
                    <option value="충청북도">충청북도</option>
                    <option value="충청남도">충청남도</option>
                    <option value="전라북도">전라북도</option>
                    <option value="전라남도">전라남도</option>
                    <option value="경상북도">경상북도</option>
                    <option value="경상남도">경상남도</option>
                    <option value="제주특별자치도">제주특별자치도</option>
                </select>
            </div>
            <div class="form-group">
                <input type="date" v-model="birthDate" required>
            </div>
            <div class="form-group gender-inline">
                <span>성별: </span>
                <input type="radio" id="male" value="M" v-model="gender"><label for="male">남성</label>
                <input type="radio" id="female" value="F" v-model="gender"><label for="female">여성</label>
            </div>
            <div class="form-group role-inline">
                <span style="min-width: 80px;">회원 분류: </span>
                <input type="radio" id="role30" value="30" v-model="role"><label for="role30">일반 회원</label>
                <input type="radio" id="role20" value="20" v-model="role"><label for="role20">부동산 매매자</label>
                <input v-if="isAdminMode" type="radio" id="role10" value="10" v-model="role"><label for="role10">관리자</label>
            </div>
        </div>
        <div class="form-section optional">
            <h3>선택 정보</h3>
            <div class="form-group">
                <input type="text" placeholder="선호 지역" v-model="preferredLocation">
            </div>
            <div class="form-group">
                <select v-model="budget">
                    <option value="">선택 안 함</option>
                    <option value="5억 미만">5억 미만</option>
                    <option value="5억 ~ 10억">5억 ~ 10억 미만</option>
                    <option value="10억 이상">10억 이상</option>
                </select>
            </div>
        </div>

        <button type="button" class="register-button" @click="fnSignUp">
            {{ isAdminMode ? '회원 추가 완료' : '회원가입 완료' }}
        </button>
        <button type="button" class="cancel-button" @click="goBack">취소</button>
    </form>
</div>
</body>
</html>
<script>
    const app = Vue.createApp({
        data() {
            return {
                userName: '',
                password: '',
                confirmPassword: '',
                name: '',
                phonePrefix: '010',
                phoneMiddle: '',
                phoneLast: '',
                email: '',
                currentAddress: '',
                birthDate: '',
                gender: '',
                role: '', 
                preferredLocation: '',
                budget: '',
                nickName : '',
                isUsernameChecked: false,
                isAdminMode: false
            };
        },
        methods: {
            goBack() {
                window.location.href = "main.html?menu=members";
            },           
            checkUserName() {
                let self = this;
                if(!self.userName) {
                    alert('아이디를 입력해주세요.');
                    return;
                }
                $.ajax({
                    url: "http://localhost:3009/clients/check-username",
                    type: "GET",
                    dataType: "json",
                    data: { username: self.userName },
                    success: (data) => {
                        if(data.exists) {
                            alert('이미 사용 중인 아이디입니다.');
                            self.isUsernameChecked = false;
                        } else {
                            alert('사용 가능한 아이디입니다.');
                            self.isUsernameChecked = true;
                        }
                    },
                    error: (err) => {
                        console.error(err);
                        alert('서버 오류 발생');
                        self.isUsernameChecked = false;
                    }
                });
            },

            validate() {
                let self = this;
                if(!self.isUsernameChecked) {
                    alert('아이디 중복 확인을 먼저 해주세요!');
                    return false;
                }

                const namePattern = /^[가-힣a-zA-Z]+$/;
                if(!namePattern.test(self.name)) { alert('이름은 한글 또는 영어만 가능합니다.'); return false; }

                const numberPattern = /^[0-9]+$/;
                if(!numberPattern.test(self.phoneMiddle) || !numberPattern.test(self.phoneLast)) {
                    alert('연락처는 숫자만 입력해주세요.');
                    return false;
                }

                const specialPattern = /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]+/;
                if(!specialPattern.test(self.password)) { alert('비밀번호에는 특수문자가 필요합니다.'); return false; }

                if(self.password !== self.confirmPassword) { alert('비밀번호가 일치하지 않습니다.'); return false; }

                if(!self.userName || !self.password || !self.name || !self.phonePrefix || !self.phoneMiddle || !self.phoneLast || !self.email || !self.currentAddress || !self.birthDate || !self.gender) {
                    alert('필수 항목을 모두 입력해주세요.');
                    return false;
                }

                return true;
            },

            fnSignUp() {
                let self = this;
                if(!self.validate()) return;

                const fullPhoneNumber = `${self.phonePrefix}-${self.phoneMiddle}-${self.phoneLast}`;
                const param = {
                    username: self.userName,
                    password: self.password,
                    name: self.name,
                    nickname: self.nickName,
                    phone: fullPhoneNumber,
                    email: self.email,
                    currentAddress: self.currentAddress,
                    birthDate: self.birthDate,
                    gender: self.gender,
                    role: self.role,
                    preferredLocation: self.preferredLocation || null,
                    budget: self.budget || null
                };

                $.ajax({
                    url: "http://localhost:3009/clients/insert",
                    type: "GET",
                    dataType: "json",
                    data: param,
                    success: (data) => {
                        alert(self.isAdminMode ? '회원 추가 완료!' : '회원가입 완료!');
                        if(self.isAdminMode){
                            window.location.href = "main.html"; // 관리자 모드면 메인으로
                        } else {
                            window.location.href = "index.html"; // 일반 회원 가입
                        }
                    },
                    error: (err) => {
                        console.error(err);
                        alert('서버 오류 발생');
                    }
                });
            }
        },
        mounted() {
            let self = this;
            const params = new URLSearchParams(window.location.search);
            if(params.get('mode') === 'admin'){
                self.isAdminMode = true;
            }
        }
    });
    app.mount('#app');
</script>

